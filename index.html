<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>운빨배틀타로 - 세컨머니 AI</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #fdfaf5;
      color: #333;
      text-align: center;
      padding: 2rem;
    }
    .card {
      font-size: 2rem;
      margin: 1rem;
    }
    #resultArea, #bonusMessage, #summary, #visitorCount {
      margin-top: 1.5rem;
    }
    button {
      font-size: 1rem;
      padding: 0.5rem 1rem;
      margin: 1rem;
      cursor: pointer;
    }
    a {
      text-decoration: none;
      font-weight: bold;
      color: #0077cc;
    }
  </style>
</head>
<body>
  <h1>🔮 운빨배틀타로</h1>
  <p>오늘의 운을 세 장의 타로카드로 확인해보세요!</p>

  <button onclick="drawCard()">카드 뽑기</button>
  <button onclick="location.reload()">다시하기</button>
  <button onclick="shareResult()">공유하기</button>

  <div id="resultArea"></div>
  <div id="bonusMessage"></div>
  <div id="summary"></div>

  <script>
    const tarotDeck = {
      "The Fool": { upright: { score: 3 }, reversed: { score: -2 } },
      "The Magician": { upright: { score: 2 }, reversed: { score: -1 } },
      "The High Priestess": { upright: { score: 2 }, reversed: { score: -1 } },
      "The Empress": { upright: { score: 3 }, reversed: { score: -2 } },
      "The Emperor": { upright: { score: 2 }, reversed: { score: -1 } },
      "The Hierophant": { upright: { score: 1 }, reversed: { score: -1 } },
      "The Lovers": { upright: { score: 3 }, reversed: { score: -2 } },
      "The Chariot": { upright: { score: 2 }, reversed: { score: -1 } },
      "Strength": { upright: { score: 2 }, reversed: { score: -2 } },
      "The Hermit": { upright: { score: 1 }, reversed: { score: -1 } },
      "Wheel of Fortune": { upright: { score: 4 }, reversed: { score: -2 } },
      "Justice": { upright: { score: 2 }, reversed: { score: -1 } },
      "The Hanged Man": { upright: { score: 1 }, reversed: { score: -2 } },
      "Death": { upright: { score: 2 }, reversed: { score: -2 } },
      "Temperance": { upright: { score: 2 }, reversed: { score: -1 } },
      "The Devil": { upright: { score: -2 }, reversed: { score: 1 } },
      "The Tower": { upright: { score: -3 }, reversed: { score: -1 } },
      "The Star": { upright: { score: 3 }, reversed: { score: 1 } },
      "The Moon": { upright: { score: -1 }, reversed: { score: -2 } },
      "The Sun": { upright: { score: 4 }, reversed: { score: 1 } },
      "Judgement": { upright: { score: 3 }, reversed: { score: 0 } },
      "The World": { upright: { score: 5 }, reversed: { score: 1 } },
    };

    const bonusCombinations = [
      { cards: ["The Sun", "The World", "The Star"], condition: "upright", bonusMessage: "🌟 우주가 당신을 돕고 있습니다! 최고의 조합이에요!" },
      { cards: ["The Tower", "Death", "The Devil"], condition: "reversed", bonusMessage: "😈 위기를 기회로! 극복의 조합입니다." },
      { cards: ["The Fool", "The Magician", "The High Priestess"], condition: "upright", bonusMessage: "🔮 새로운 시작을 향한 완벽한 흐름!" }
    ];

    let drawnCards = [];
    let phase = 0;

    function drawCard() {
      const names = Object.keys(tarotDeck);
      let card;
      do {
        card = names[Math.floor(Math.random() * names.length)];
      } while (drawnCards.some(c => c.name === card));
      const orientation = Math.random() < 0.5 ? "upright" : "reversed";
      drawnCards.push({ name: card, orientation: orientation });
      const cardText = orientation === "upright" ? `${card}` : `${card} (역방향)`;
      const resultArea = document.getElementById("resultArea");
      resultArea.innerHTML += `<div class="card">🃏 ${["과거", "현재", "미래"][phase]}: <strong>${cardText}</strong></div>`;
      phase++;

      if (phase === 3) {
        document.querySelector("button[onclick='drawCard()']").disabled = true;
        evaluateBonus();
        summarizeReading();
      }
    }

    function evaluateBonus() {
      const names = drawnCards.map(c => c.name);
      const orientations = drawnCards.map(c => c.orientation);
      const bonusDiv = document.getElementById("bonusMessage");

      for (const combo of bonusCombinations) {
        const isMatch = combo.cards.every(c => names.includes(c));
        const allSameOrientation = combo.cards.every(c => {
          const idx = names.indexOf(c);
          return orientations[idx] === combo.condition;
        });
        if (isMatch && allSameOrientation) {
          bonusDiv.innerHTML = `<p><strong>${combo.bonusMessage}</strong></p>`;
          break;
        }
      }
    }

    function summarizeReading() {
      const totalScore = drawnCards.reduce((sum, c) => sum + tarotDeck[c.name][c.orientation].score, 0);
      let message;

      if (totalScore >= 13) message = "🌈 신의 가호가 함께하는 날이에요! 기회가 왔어요 💫";
      else if (totalScore >= 10) message = "🔥 아주 좋은 흐름이에요! 원하는 걸 확실히 잡아보세요!";
      else if (totalScore >= 7) message = "😄 순조롭고 무난한 하루! 편안하게 보내세요.";
      else if (totalScore >= 4) message = "🙂 약간 애매하지만 크게 나쁘지 않아요.";
      else if (totalScore >= 1) message = "😐 조심하면 무난할 수도 있어요.";
      else if (totalScore >= -2) message = "⚠️ 신중하게! 오늘은 살짝 불안정한 기운이 보여요.";
      else message = "🚨 긴장하세요! 오늘은 완전 운빨 지옥입니다...";

      let percentile;
      if (totalScore >= 15) percentile = "상위 0.1%";
      else if (totalScore === 14) percentile = "상위 0.5%";
      else if (totalScore === 13) percentile = "상위 1%";
      else if (totalScore === 12) percentile = "상위 2%";
      else if (totalScore === 11) percentile = "상위 4%";
      else if (totalScore === 10) percentile = "상위 7%";
      else if (totalScore === 9) percentile = "상위 10%";
      else if (totalScore === 8) percentile = "상위 15%";
      else if (totalScore === 7) percentile = "상위 20%";
      else if (totalScore === 6) percentile = "상위 30%";
      else if (totalScore === 5) percentile = "상위 40%";
      else if (totalScore >= 3) percentile = "상위 55%";
      else if (totalScore >= 1) percentile = "상위 70%";
      else if (totalScore >= -2) percentile = "상위 85%";
      else percentile = "상위 99%";

      const summary = document.getElementById("summary");
      summary.innerHTML = `
        <h3>📌 종합 운세: ${totalScore}점</h3>
        <p>${message}</p>
        <p>📊 <strong>${percentile} 운세</strong>입니다.</p>
      `;
    }

    function shareResult() {
      const shareText = "🔮 오늘의 운빨배틀타로 결과 확인해보세요!\n👉 https://jeffersonwattson.github.io/tarot-ai/";
      if (navigator.share) {
        navigator.share({
          title: "운빨배틀타로 - 세컨머니 AI",
          text: shareText,
          url: window.location.href
        });
      } else {
        alert("공유 기능은 모바일에서만 지원됩니다!");
      }
    }
  </script>
</body>
</html>
