<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>운빨배틀타로 - 세컨머니 AI</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #fdfaf5;
      color: #333;
      text-align: center;
      padding: 2rem;
    }
    .card { font-size: 1.8rem; margin: 1rem; }
    #resultArea, #summary { margin-top: 1.5rem; }
    button {
      font-size: 1rem; padding: 0.6rem 1.2rem;
      margin: 0.5rem; cursor: pointer;
    }
    a {
      text-decoration: none;
      font-weight: bold;
      color: #0077cc;
    }
    @media (max-width: 600px) {
      body { font-size: 0.9rem; }
      .card { font-size: 1.4rem; }
      button {
        font-size: 0.9rem;
        padding: 0.5rem 1rem;
      }
      h1 { font-size: 1.5rem; }
      p, a { font-size: 0.9rem; }
    }
  </style>
</head>
<body>
  <h1>🔮 운빨배틀타로</h1>
  <p>오늘의 운을 세 장의 타로카드로 확인해보세요!</p>
  <p>
    📌 더 많은 돈 되는 실험은  
    <a href="https://blog.naver.com/greenfrog232" target="_blank">
      세컨머니 실험실 블로그V1.5
    </a>
    에서 확인해보세요!
  </p>

  <div id="buttonArea">
    <button onclick="chooseCard('A')">A</button>
    <button onclick="chooseCard('B')">B</button>
    <button onclick="chooseCard('C')">C</button>
  </div>
  <button onclick="location.reload()">다시하기</button>
  <button onclick="shareResult()">공유하기</button>

  <div id="resultArea"></div>
  <div id="summary"></div>

<script>
const tarotDeck = {
  "빡통": { up: { score: 7, emoji: "🤡" }, down: { score: 3, emoji: "🤡" } },
  "마법사": { up: { score: 8, emoji: "🧙" }, down: { score: 4, emoji: "🧙" } },
  "여사제": { up: { score: 8, emoji: "👸" }, down: { score: 5, emoji: "👸" } },
  "여황제": { up: { score: 9, emoji: "👑" }, down: { score: 5, emoji: "👑" } },
  "황제": { up: { score: 9, emoji: "🦁" }, down: { score: 6, emoji: "🦁" } },
  "교황": { up: { score: 8, emoji: "🙏" }, down: { score: 5, emoji: "🙏" } },
  "연인": { up: { score: 10, emoji: "💘" }, down: { score: 4, emoji: "💘" } },
  "전차": { up: { score: 9, emoji: "🏎️" }, down: { score: 4, emoji: "🏎️" } },
  "힘,기백": { up: { score: 8, emoji: "💪" }, down: { score: 4, emoji: "💪" } },
  "은둔자,찐따": { up: { score: 7, emoji: "🧘" }, down: { score: 3, emoji: "🧘" } },
  "운명의 수레바퀴": { up: { score: 10, emoji: "🎡" }, down: { score: 5, emoji: "🎡" } },
  "정의": { up: { score: 8, emoji: "⚖️" }, down: { score: 5, emoji: "⚖️" } },
  "매달린사람": { up: { score: 6, emoji: "🙃" }, down: { score: 2, emoji: "🙃" } },
  "죽음": { up: { score: 9, emoji: "💀" }, down: { score: 3, emoji: "💀" } },
  "절제": { up: { score: 8, emoji: "🌈" }, down: { score: 4, emoji: "🌈" } },
  "악마": { up: { score: 6, emoji: "😈" }, down: { score: 3, emoji: "😈" } },
  "The Tower": { up: { score: 7, emoji: "🌩️" }, down: { score: 2, emoji: "🌩️" } },
  "The Star": { up: { score: 10, emoji: "⭐" }, down: { score: 6, emoji: "⭐" } },
  "The Moon": { up: { score: 7, emoji: "🌙" }, down: { score: 4, emoji: "🌙" } },
  "The Sun": { up: { score: 10, emoji: "☀️" }, down: { score: 6, emoji: "☀️" } },
  "심판": { up: { score: 9, emoji: "📣" }, down: { score: 5, emoji: "📣" } },
  "The World": { up: { score: 10, emoji: "🌍" }, down: { score: 6, emoji: "🌍" } }
};

const rareCombosSimple = {
  ["The Moon|The Star|The Sun".split("|").sort().join("|")]: "밤과 낮의 경계에서 기회가 피어납니다 🌟🌙☀️ (레어)",
  ["The Moon|운명의 수레바퀴|여사제".split("|").sort().join("|")]: "직관과 흐름을 믿으세요. 감춰진 기회가 보일지도 🌙🎡👁️ (레어)",
  ["The Star|교황|절제".split("|").sort().join("|")]: "영적인 치유와 조화의 기운이 가득한 하루입니다 🙏🌈✨ (레어)",
  ["The Star|심판|은둔자,찐따".split("|").sort().join("|")]: "쌓은 노력, 드디어 빛을 볼 준비가 되었습니다 ✨🧘📣 (레어)",
  ["The Star|여사제|연인".split("|").sort().join("|")]: "이상과 사랑의 하모니! 설렘 가득한 하루 💘✨👸 (레어)",
  ["The Sun|The World|연인".split("|").sort().join("|")]: "완벽한 사랑과 성공! 오늘은 우주의 축복이 함께합니다 💖🌞🌍 (레어)",
  ["The Sun|전차|정의".split("|").sort().join("|")]: "정의로운 돌진! 오늘은 내가 법이다 🏎️☀️⚖️ (레어)",
  ["The Tower|운명의 수레바퀴|전차".split("|").sort().join("|")]: "멈출 수 없는 변화의 질주! 새판 짜기 시작! 🎡🏎️💀 (레어)",
  ["The Tower|전차|힘,기백".split("|").sort().join("|")]: "강한 추진력도 필요하지만 조심! 속도 조절! 🏎️💥💪 (레어)",
  ["The Tower|빡통|전차".split("|").sort().join("|")]: "아찔한 질주, 정신줄 조심! 오늘은 사고방지데이 🤡🏎️😈 (레어)",
  ["The Tower|악마|죽음".split("|").sort().join("|")]: "심상치 않은 조합입니다. 내면을 단단히 다잡으세요. (레어)",
  ["교황|마법사|황제".split("|").sort().join("|")]: "지혜와 권력이 한 자리에! 리더십이 빛날 날입니다 👑📘🧙 (레어)",
  ["교황|여사제|황제".split("|").sort().join("|")]: "지식, 신념, 권력이 만났습니다. 누가 감히 넘보랴 🙇📘👑 (레어)",
  ["마법사|심판|죽음".split("|").sort().join("|")]: "변화의 마법이 시작됩니다. 운명의 심판을 받아라! 🧙💀📣 (레어)",
  ["매달린사람|빡통|은둔자,찐따".split("|").sort().join("|")]: "혼자만의 세계에 빠질 수 있어요. 조용한 하루를 추천합니다. (레어)",
  ["여사제|연인|절제".split("|").sort().join("|")]: "사랑과 조화의 에너지! 인간관계가 술술 풀릴 거예요 💕🤝🌈 (레어)",
  ["여황제|연인|황제".split("|").sort().join("|")]: "이보다 완벽한 밸런스는 없다! 💑👑 (레어)",
  ["운명의 수레바퀴|심판|정의".split("|").sort().join("|")]: "운명과 정의, 그리고 심판! 변화의 중심에 있습니다 ⚖️🌀📣 (레어)",
  ["은둔자,찐따|The Moon|악마".split("|").sort().join("|")]: "내면의 어둠을 직면하세요. 피하지 말고 마주보는 날 🧘🌙😈 (레어)",
  ["정의|죽음|악마".split("|").sort().join("|")]: "어둠 속에서도 균형을 찾는 자만이 변화를 이끈다 😈💀⚖️ (레어)"
};


let bundles = { A: [], B: [], C: [] };
let selectedSet = null;
let revealed = false;

function drawThreeCards() {
  const names = Object.keys(tarotDeck);
  const used = new Set();
  const result = [];

  while (result.length < 3) {
    const name = names[Math.floor(Math.random() * names.length)];
    if (!used.has(name)) {
      used.add(name);
      const orientation = Math.random() > 0.5 ? "up" : "down";
      result.push({ name, orientation });
    }
  }

  return result;
}

function prepareDeck() {
  bundles.A = drawThreeCards();
  bundles.B = drawThreeCards();
  bundles.C = drawThreeCards();
}

function chooseCard(choice) {
  if (revealed) return;
  revealed = true;
  selectedSet = bundles[choice];
  document.querySelectorAll("#buttonArea button").forEach(btn => btn.disabled = true);

  let upCount = 0;
  let downCount = 0;

  const totalScore = selectedSet.reduce((sum, card) => {
    const info = tarotDeck[card.name]?.[card.orientation];
    if (!info) return sum;
    if (card.orientation === "up") upCount++;
    else downCount++;
    return sum + info.score;
  }, 0);

  const currentComboKey = selectedSet.map(c => c.name).sort().join("|");
  let comboMessage = rareCombosSimple[currentComboKey] || "";

  if (!comboMessage) {
    if (upCount === 3) comboMessage = "정방향 3장! 운이 강하게 따라붙습니다 🎯";
    else if (downCount === 3) comboMessage = "모두 역방향... 예상과 다른 흐름이에요 ⚠️";
    else if (upCount === 2) comboMessage = "정방향 2장 😊 운이 트이기 시작했어요!";
    else if (downCount === 2) comboMessage = "역방향 2장. 신중한 하루가 될 수도 있어요!";
    else comboMessage = "";
  }

  let resultHTML = `<h3>🔮 ${choice} 선택 결과</h3>`;
  selectedSet.forEach(card => {
    const info = tarotDeck[card.name]?.[card.orientation];
    if (!info) return;
    const arrow = card.orientation === "up" ? "⬆️" : "⬇️";
    const direction = card.orientation === "up" ? "정방향" : "역방향";
    resultHTML += `
      <div class="card">${info.emoji} ${card.name} ${arrow} (${direction})<br>
      점수: ${info.score}점</div>`;
  });

  if (comboMessage) {
    resultHTML += `<p><strong>${comboMessage}</strong></p>`;
  }

  const ratingText = totalScore === 30 ? "총합: 30점 (만점!)" :
    totalScore <= 10 ? `총합: ${totalScore}점 (운보소 ㅋㅋㅋ)` :
    `총합: ${totalScore}점 (상위 ${Math.round((totalScore / 30) * 100)}%)`;

  resultHTML += `<p><strong>${ratingText}</strong></p>`;
  document.getElementById("resultArea").innerHTML = resultHTML;

  let summaryHTML = `<h3>📊 다른 선택지 점수 요약</h3>`;
  ["A", "B", "C"].forEach(label => {
    if (label === choice) return;
    const score = bundles[label].reduce((sum, c) => {
      const info = tarotDeck[c.name]?.[c.orientation];
      return sum + (info?.score || 0);
    }, 0);
    const percent = Math.round((score / 30) * 100);
    summaryHTML += `<p>🔸 ${label} 카드: ${score}점 (${percent}%)</p>`;
  });

  document.getElementById("summary").innerHTML = summaryHTML;
  document.getElementById("buttonArea").style.display = "none";
}

function shareResult() {
  if (!selectedSet) return alert("카드를 먼저 선택해 주세요!");
  const shareText = selectedSet.map(card => {
    const info = tarotDeck[card.name][card.orientation];
    const arrow = card.orientation === "up" ? "⬆️" : "⬇️";
    return `${info.emoji} ${card.name} ${arrow}`;
  }).join(", ");
  const totalScore = selectedSet.reduce(
    (sum, c) => sum + tarotDeck[c.name][c.orientation].score,
    0
  );
  const fullText = `🔮 운빨배틀타로 결과!\n[${shareText}]\n총점: ${totalScore}점\n👉 https://jeffersonwattson.github.io/tarot-ai/`;

  if (navigator.share) {
    navigator.share({ title: "운빨배틀타로", text: fullText, url: window.location.href });
  } else {
    navigator.clipboard.writeText(fullText).then(() => alert("결과 복사됨 📋"));
  }
}

window.onload = prepareDeck;
</script>
</body>
</html>
