<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ìš´ë¹¨ë°°í‹€íƒ€ë¡œ - ì„¸ì»¨ë¨¸ë‹ˆ AI</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #fdfaf5;
      color: #333;
      text-align: center;
      padding: 2rem;
    }
    .card {
      font-size: 2rem;
      margin: 1rem;
    }
    #resultArea, #bonusMessage, #summary, #visitorCount {
      margin-top: 1.5rem;
    }
    button {
      font-size: 1rem;
      padding: 0.5rem 1rem;
      margin: 1rem;
      cursor: pointer;
    }
    a {
      text-decoration: none;
      font-weight: bold;
      color: #0077cc;
    }
  </style>
</head>
<body>
  <h1>ğŸ”® ìš´ë¹¨ë°°í‹€íƒ€ë¡œ</h1>
  <p>ì˜¤ëŠ˜ì˜ ìš´ì„ ì„¸ ì¥ì˜ íƒ€ë¡œì¹´ë“œë¡œ í™•ì¸í•´ë³´ì„¸ìš”!</p>

  <button onclick="drawCard()">ì¹´ë“œ ë½‘ê¸°</button>
  <button onclick="location.reload()">ë‹¤ì‹œí•˜ê¸°</button>
  <button onclick="shareResult()">ê³µìœ í•˜ê¸°</button>

  <div id="resultArea"></div>
  <div id="bonusMessage"></div>
  <div id="summary"></div>

  <script>
    const tarotDeck = {
      "The Fool": { upright: { score: 3 }, reversed: { score: -2 } },
      "The Magician": { upright: { score: 2 }, reversed: { score: -1 } },
      "The High Priestess": { upright: { score: 2 }, reversed: { score: -1 } },
      "The Empress": { upright: { score: 3 }, reversed: { score: -2 } },
      "The Emperor": { upright: { score: 2 }, reversed: { score: -1 } },
      "The Hierophant": { upright: { score: 1 }, reversed: { score: -1 } },
      "The Lovers": { upright: { score: 3 }, reversed: { score: -2 } },
      "The Chariot": { upright: { score: 2 }, reversed: { score: -1 } },
      "Strength": { upright: { score: 2 }, reversed: { score: -2 } },
      "The Hermit": { upright: { score: 1 }, reversed: { score: -1 } },
      "Wheel of Fortune": { upright: { score: 4 }, reversed: { score: -2 } },
      "Justice": { upright: { score: 2 }, reversed: { score: -1 } },
      "The Hanged Man": { upright: { score: 1 }, reversed: { score: -2 } },
      "Death": { upright: { score: 2 }, reversed: { score: -2 } },
      "Temperance": { upright: { score: 2 }, reversed: { score: -1 } },
      "The Devil": { upright: { score: -2 }, reversed: { score: 1 } },
      "The Tower": { upright: { score: -3 }, reversed: { score: -1 } },
      "The Star": { upright: { score: 3 }, reversed: { score: 1 } },
      "The Moon": { upright: { score: -1 }, reversed: { score: -2 } },
      "The Sun": { upright: { score: 4 }, reversed: { score: 1 } },
      "Judgement": { upright: { score: 3 }, reversed: { score: 0 } },
      "The World": { upright: { score: 5 }, reversed: { score: 1 } },
    };

    const bonusCombinations = [
      { cards: ["The Sun", "The World", "The Star"], condition: "upright", bonusMessage: "ğŸŒŸ ìš°ì£¼ê°€ ë‹¹ì‹ ì„ ë•ê³  ìˆìŠµë‹ˆë‹¤! ìµœê³ ì˜ ì¡°í•©ì´ì—ìš”!" },
      { cards: ["The Tower", "Death", "The Devil"], condition: "reversed", bonusMessage: "ğŸ˜ˆ ìœ„ê¸°ë¥¼ ê¸°íšŒë¡œ! ê·¹ë³µì˜ ì¡°í•©ì…ë‹ˆë‹¤." },
      { cards: ["The Fool", "The Magician", "The High Priestess"], condition: "upright", bonusMessage: "ğŸ”® ìƒˆë¡œìš´ ì‹œì‘ì„ í–¥í•œ ì™„ë²½í•œ íë¦„!" }
    ];

    let drawnCards = [];
    let phase = 0;

    function drawCard() {
      const names = Object.keys(tarotDeck);
      let card;
      do {
        card = names[Math.floor(Math.random() * names.length)];
      } while (drawnCards.some(c => c.name === card));
      const orientation = Math.random() < 0.5 ? "upright" : "reversed";
      drawnCards.push({ name: card, orientation: orientation });
      const cardText = orientation === "upright" ? `${card}` : `${card} (ì—­ë°©í–¥)`;
      const resultArea = document.getElementById("resultArea");
      resultArea.innerHTML += `<div class="card">ğŸƒ ${["ê³¼ê±°", "í˜„ì¬", "ë¯¸ë˜"][phase]}: <strong>${cardText}</strong></div>`;
      phase++;

      if (phase === 3) {
        document.querySelector("button[onclick='drawCard()']").disabled = true;
        evaluateBonus();
        summarizeReading();
      }
    }

    function evaluateBonus() {
      const names = drawnCards.map(c => c.name);
      const orientations = drawnCards.map(c => c.orientation);
      const bonusDiv = document.getElementById("bonusMessage");

      for (const combo of bonusCombinations) {
        const isMatch = combo.cards.every(c => names.includes(c));
        const allSameOrientation = combo.cards.every(c => {
          const idx = names.indexOf(c);
          return orientations[idx] === combo.condition;
        });
        if (isMatch && allSameOrientation) {
          bonusDiv.innerHTML = `<p><strong>${combo.bonusMessage}</strong></p>`;
          break;
        }
      }
    }

    function summarizeReading() {
      const totalScore = drawnCards.reduce((sum, c) => sum + tarotDeck[c.name][c.orientation].score, 0);
      let message;

      if (totalScore >= 13) message = "ğŸŒˆ ì‹ ì˜ ê°€í˜¸ê°€ í•¨ê»˜í•˜ëŠ” ë‚ ì´ì—ìš”! ê¸°íšŒê°€ ì™”ì–´ìš” ğŸ’«";
      else if (totalScore >= 10) message = "ğŸ”¥ ì•„ì£¼ ì¢‹ì€ íë¦„ì´ì—ìš”! ì›í•˜ëŠ” ê±¸ í™•ì‹¤íˆ ì¡ì•„ë³´ì„¸ìš”!";
      else if (totalScore >= 7) message = "ğŸ˜„ ìˆœì¡°ë¡­ê³  ë¬´ë‚œí•œ í•˜ë£¨! í¸ì•ˆí•˜ê²Œ ë³´ë‚´ì„¸ìš”.";
      else if (totalScore >= 4) message = "ğŸ™‚ ì•½ê°„ ì• ë§¤í•˜ì§€ë§Œ í¬ê²Œ ë‚˜ì˜ì§€ ì•Šì•„ìš”.";
      else if (totalScore >= 1) message = "ğŸ˜ ì¡°ì‹¬í•˜ë©´ ë¬´ë‚œí•  ìˆ˜ë„ ìˆì–´ìš”.";
      else if (totalScore >= -2) message = "âš ï¸ ì‹ ì¤‘í•˜ê²Œ! ì˜¤ëŠ˜ì€ ì‚´ì§ ë¶ˆì•ˆì •í•œ ê¸°ìš´ì´ ë³´ì—¬ìš”.";
      else message = "ğŸš¨ ê¸´ì¥í•˜ì„¸ìš”! ì˜¤ëŠ˜ì€ ì™„ì „ ìš´ë¹¨ ì§€ì˜¥ì…ë‹ˆë‹¤...";

      let percentile;
      if (totalScore >= 15) percentile = "ìƒìœ„ 0.1%";
      else if (totalScore === 14) percentile = "ìƒìœ„ 0.5%";
      else if (totalScore === 13) percentile = "ìƒìœ„ 1%";
      else if (totalScore === 12) percentile = "ìƒìœ„ 2%";
      else if (totalScore === 11) percentile = "ìƒìœ„ 4%";
      else if (totalScore === 10) percentile = "ìƒìœ„ 7%";
      else if (totalScore === 9) percentile = "ìƒìœ„ 10%";
      else if (totalScore === 8) percentile = "ìƒìœ„ 15%";
      else if (totalScore === 7) percentile = "ìƒìœ„ 20%";
      else if (totalScore === 6) percentile = "ìƒìœ„ 30%";
      else if (totalScore === 5) percentile = "ìƒìœ„ 40%";
      else if (totalScore >= 3) percentile = "ìƒìœ„ 55%";
      else if (totalScore >= 1) percentile = "ìƒìœ„ 70%";
      else if (totalScore >= -2) percentile = "ìƒìœ„ 85%";
      else percentile = "ìƒìœ„ 99%";

      const summary = document.getElementById("summary");
      summary.innerHTML = `
        <h3>ğŸ“Œ ì¢…í•© ìš´ì„¸: ${totalScore}ì </h3>
        <p>${message}</p>
        <p>ğŸ“Š <strong>${percentile} ìš´ì„¸</strong>ì…ë‹ˆë‹¤.</p>
      `;
    }

    function shareResult() {
      const shareText = "ğŸ”® ì˜¤ëŠ˜ì˜ ìš´ë¹¨ë°°í‹€íƒ€ë¡œ ê²°ê³¼ í™•ì¸í•´ë³´ì„¸ìš”!\nğŸ‘‰ https://jeffersonwattson.github.io/tarot-ai/";
      if (navigator.share) {
        navigator.share({
          title: "ìš´ë¹¨ë°°í‹€íƒ€ë¡œ - ì„¸ì»¨ë¨¸ë‹ˆ AI",
          text: shareText,
          url: window.location.href
        });
      } else {
        alert("ê³µìœ  ê¸°ëŠ¥ì€ ëª¨ë°”ì¼ì—ì„œë§Œ ì§€ì›ë©ë‹ˆë‹¤!");
      }
    }
  </script>
</body>
</html>
